!function(t){function e(i){if(a[i])return a[i].exports;var r=a[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var a={};e.m=t,e.c=a,e.d=function(t,a,i){e.o(t,a)||Object.defineProperty(t,a,{enumerable:!0,get:i})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,a){if(1&a&&(t=e(t)),8&a)return t;if(4&a&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(e.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&a&&"string"!=typeof t)for(var r in t)e.d(i,r,function(e){return t[e]}.bind(null,r));return i},e.n=function(t){var a=t&&t.__esModule?function(){return t["default"]}:function(){return t};return e.d(a,"a",a),a},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,a){"use strict";var i=function(){function t(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,a,i){return a&&t(e.prototype,a),i&&t(e,i),e}}();$(function(){var t=window.Weblog&&new Weblog;t.plug(Weblog.builtIns.impr),window.weblog=t,$.cookie("auth_key")&&(location.href=globalConfig.rootDomain),$("#login .register").attr("href","/reg/?returnUrl="+$.getQueryString("returnUrl")),$(".user-logined").hide();var e,a=$("#code"),r=$(".status"),n=$("#login"),s=$("#login-switch"),o=$("#login-account-switch"),c=$(".refresh-btn"),l=$(".fail-msg"),u=$(".promt-info"),d=(location.href,function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.dom=e,this.url="http://scan.acfun.cn/rest/pc-direct/qr/start",this.checkurl="http://scan.acfun.cn/rest/pc-direct/qr/scanResult",this.accepturl="http://scan.acfun.cn/rest/pc-direct/qr/acceptResult",this.createcode(),this.clickinit()}return i(t,[{key:"createcode",value:function(){var t=this;$.ajax({type:"get",url:this.url+"?type=WEB_LOGIN",xhrFields:{withCredentials:!0}}).done(function(e){a.find("img").attr("src","data:image/png;base64,"+e.imageData),t.checkstatus(e.qrLoginToken,e.qrLoginSignature)})}},{key:"checkstatus",value:function(t,e){var a=this;$.ajax({type:"get",url:this.checkurl+"?qrLoginToken="+t+"&qrLoginSignature="+e,xhrFields:{withCredentials:!0}}).done(function(e){switch(e.result){case 0:r.removeClass("status-fail status-fresh").addClass("status-success").show(),a.checkaccept(t,e.qrLoginSignature);break;case 100400002:r.removeClass("status-fail status-success").addClass("status-fresh").show();break;default:r.removeClass("status-fresh status-success").addClass("status-fail").show()}})}},{key:"checkaccept",value:function(t,e){$.ajax({type:"get",url:this.accepturl+"?qrLoginToken="+t+"&qrLoginSignature="+e,xhrFields:{withCredentials:!0}}).done(function(t){switch(t.result){case 0:var e=$.getQueryString("returnUrl");e=e.length?decodeURIComponent(e):"/",window.location.href=e;break;case 100400002:r.removeClass("status-fail status-success").addClass("status-fresh").show();break;default:r.removeClass("status-fresh status-success").addClass("status-fail").show(),setTimeout(function(){location.reload()},3e3)}})}},{key:"clickinit",value:function(){var t=this,e=this;s.on("click",function(){$(this),n.hasClass("login-account")?(n.removeClass("login-account"),u.hide(),e.createcode(),$(".status").removeClass("status-fresh status-fail status-success"),o.text("账号登录"),$("#loginheader").text("手机扫码登录")):(n.addClass("login-account"),o.text("忘记密码"),$("#loginheader").text("帐号登录"))}),o.click(function(){n.hasClass("login-account")?(console.log(1),window.open("http://www.acfun.cn/login/forgot")):(n.addClass("login-account"),$("#loginheader").text("帐号登录"),o.text("忘记密码"))}),c.click(function(){t.createcode(),$(".status").removeClass("status-fresh")}),l.click(function(){t.createcode(),$(".status").removeClass("status-fail")})}}]),t}()),h=($("#area-login"),$("#form-login").find(".btn-login")),f=window.Worker?["ease-in","ease-out"]:["linear","linear"],p=0|$.cookie("ac_login_error")||0;p>3?($(".captcha-pic").click(),$("#form-login div.area-captcha").removeClass("hidden"),$("#ipt-check-login").attr("disabled",!1),e=!0,$("#ipt-captcha-switch").click(function(){$(this).prev().click()})):e=!1,$("#ipt-check-login").val(""),$("#form-login").delegate("input","focus",function(){$(this).hasClass("captcha")||$(this).parent(".area").css("border","1px solid #bdbdbd")}),$("#ipt-pwd-login").on("keydown",function(t){13!=t.which&&10!=t.which||!e&&h.click()}),$("#ipt-account-login").on("blur",function(){var t=$(this);0==$.trim(t.val()).length?(u.text("用户名不能为空。").css("display","block"),t.parent(".area").css("border","1px solid red")):t.parent(".area").css("border","1px solid #ddd")}),$("#ipt-pwd-login").on("blur",function(){var t=$(this),a=$.trim(t.val()).length;return(p=0|$.cookie("ac_login_error")||0)>3?($(".captcha-pic").click(),$("#form-login div.area-captcha").removeClass("hidden"),$("#ipt-check-login").attr("disabled",!1),e=!0):e=!1,a>=6&&32>=a?void t.parent().css("border","1px solid #ddd"):(t.parent().css("border","1px solid red"),void u.text("密码长度应为6至32个字符之间！").css("display","block !important"))}),$("#ipt-check-login").on("blur",function(){var t=$(this),e=$.trim(t.val()).length;e?e>4?(u.text("验证码应为4位字符。").show(),t.css("border","1px solid red")):t.css("border","1px solid #bdbdbd"):(u.text("请输入验证码。").show(),t.css("border","1px solid red"))}),h.click(function(){if((p=0|$.cookie("ac_login_error")||0)>3&&$("#form-login div.area-captcha").hasClass("hidden"))return $("#form-login div.area-captcha").removeClass("hidden"),$("#ipt-check-login").attr("disabled",!1),void(e=!0);var t={name:$.trim($("#ipt-account-login").val()),password:$.trim($("#ipt-pwd-login").val()),captcha:$.trim($("#ipt-check-login").val())};$.info.success("登录中...");var a=btoa(Math.random().toString(36).substr(2));$.cookie("stochastic",a,{path:"/"}),$.post("/login.aspx",{username:t.name,password:t.password,captcha:t.captcha}).done(function(t){if(t.success){$.info.success("登录成功。");var a=$("#login");a.find("a.thumb img.avatar").css("opacity",0).attr("src",t.img).transition({opacity:1},300),a.find("p.welcom span.username").text(t.username),a.transition({opacity:0,rotateY:180},700,f[0],function(){a.addClass("login-success"),a.transition({opacity:1,rotateY:360},700,f[1]);var t=a.find("p.notice span"),e=3;system.login=setInterval(function(){e--,t.text(e),0>=e&&clearInterval(system.login)},1e3);var i=location.href.substr(37);i=i.length?decodeURIComponent(i):"/",setTimeout(function(){location.href=$.parseSafe(i)},2e3)})}else{switch(t.errorid){case 10710:$(".captcha-pic").click(),$("#form-login div.area-captcha").removeClass("hidden"),$("#ipt-check-login").attr("disabled",!1),e=!0;break;case 10074:u.text(t.result).show();break;case 10784:u.text(t.result).show(),$.info.warning(t.result);break;default:u.text(t.result).show()}e&&$("#form-login div.area-captcha img.captcha-pic").click(),p++,$.cookie("ac_login_error",p,{expires:1}),(p>3||-1!=t.result.search("captcha"))&&($("#form-login div.area-captcha").removeClass("hidden"),$("#ipt-check-login").attr("disabled",!1),e||setTimeout(function(){return location.reload()},1e3),e=!0),-1!=t.result.search("captcha")&&(3>=p?(p=4,$.cookie("ac_login_error",p,{expires:1}),$.info.warning("请输入验证码。")):$.info.warning(t.result))}}).fail(function(){$.info.error("目前访问人数过多,请稍后")})}),new d(a)})}]);